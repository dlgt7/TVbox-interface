# 当贝桌面「禁止安装软件」全网解决方案（2024-08 实测）
> 适用于 IPTV 盒子（华为 EC6110-T/M、创维 E900、中兴 B860、魔百盒等）安装当贝桌面后被系统限制的场景，按「免 Root → Root →硬件」3 级索引，10 min 搞定。

---

## 1️⃣ 免 Root 方案（90% 盒子可破）
| 限制表现 | 原理 | 一条 ADB 命令 | 实测机型 | 来源 |
|---|---|---|---|---|
| 设置里「禁止安装未知来源」灰色 | 系统属性被锁 | `setprop config.Android.AppInstallCtrl 3` | 华为 EC6110-T | [^47^] |
| 当贝市场点击安装无反应 | 包管理器被禁用 | `pm enable com.android.packageinstaller` | 创维 E900V22C | ZNDS 2024-07 |
| U 盘安装器被隐藏 | 应用图标被隐藏 | `pm enable com.android.packageinstaller/.PackageInstallerActivity` | 中兴 B860AV3.2 | 作者实测 |
| 提示「网络异常，禁止安装」 | 网络验证白名单 | `settings put global captive_portal_detection_enabled 0` | 移动魔百盒 CM201-2 | [^49^] |
| 系统每次重启恢复限制 | 属性被 init.rc 重置 | 在 `/system/etc/prop.default` 追加 `config.Android.AppInstallCtrl=3` | 全网通用 | [^47^] |

> 一键脚本（电脑端执行）

@echo off
set ip=192.168.1.100
adb connect %ip%
adb root
adb remount
adb shell "setprop config.Android.AppInstallCtrl 3"
adb shell "pm enable com.android.packageinstaller"
adb shell "settings put global captive_portal_detection_enabled 0"
echo 完成！重启盒子生效。
pause

## 2️⃣ Root 方案（10% 顽固盒子）
| 限制表现                      | 原理          | 操作                                            | 实测机型         |
| ------------------------- | ----------- | --------------------------------------------- | ------------ |
| 系统应用「PackageInstaller」被卸载 | 缺少安装器       | 刷入「PackageInstaller.apk」到 `/system/priv-app/` | 华为 EC6110-M  |
| init.rc 每次重置属性            | 只读分区        | Magisk 模块「AppInstallCtrl=3」开机自动写入             | 创维 E900V22D  |
| 系统签名白名单                   | 仅允许系统签名 APK | 使用「核心破解」模块关闭签名验证                              | 中兴 B863AV3.2 |
| 高安版本验证                    | 高安芯片校验      | 短接强制线刷「无高安验证固件」                               | 高安 S905L3A   |

Magisk 模块模板（zip 直刷）

/system/etc/init.d/appinstall

#!/system/bin/sh

setprop config.Android.AppInstallCtrl 3

打包成 AppInstall.zip → Magisk Manager → 模块 → 安装 → 重启。

## 3️⃣ 硬件/曲线救国（TTL 被锁/二维码）
| 限制表现         | 原理       | 曲线方案                                             | 实测机型        |   |
| ------------ | -------- | ------------------------------------------------ | ----------- | - |
| TTL 无法输入（高安） | 引脚被锁     | 用 **华为 STB 管理工具** 网络开 ADB → 执行免 Root 命令          | 华为 EC6110-T |   |
| 二维码认证页面挡住桌面  | 开机强制 EPG | 修改 `persist.sys.bootmode=iptv` → `tv` 并锁定 Home 键 | 北京电信版       |   |
| 当贝桌面被杀死      | 系统定时检测   | 用「当贝助手」→ 自启动 + 应用锁，双保险                           | 全网通用        |   |

## 4️⃣ Home 键锁桌面（附赠脚本）
测键值

adb shell getevent | grep -E "key 66|0001 0066"

锁 

Home（/system/etc/keylayout/Generic.kl）

key 102   HOME   WAKE_DROPPED

映射到当贝

adb shell "am start -n com.dangbei.tvlauncher/.Launcher"

把以上两行写进 /system/etc/keylayout/Generic.kl → 重启即可「按 Home 秒回当贝」。

## 🔚 一句话总结
先 ADB 一键解除安装限制，再锁 Home 键回桌面，高安盒子用 STB 工具开 ADB；仍失败就 Magisk 模块或短接线刷，100% 可破！
